{"ast":null,"code":"import React,{useState,useEffect,useRef}from\"react\";import{base44}from\"@/api/base44Client\";import{useQuery,useMutation,useQueryClient}from\"@tanstack/react-query\";import{Send,Circle}from\"lucide-react\";import{Link}from\"react-router-dom\";import{createPageUrl}from\"../utils\";import{format}from\"date-fns\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function GlobalChat(){const[message,setMessage]=useState(\"\");const messagesEndRef=useRef(null);const queryClient=useQueryClient();const{data:user}=useQuery({queryKey:['currentUser'],queryFn:()=>base44.auth.me()});const{data:messages,isLoading}=useQuery({queryKey:['globalChatMessages'],queryFn:()=>base44.entities.GlobalChatMessage.list('created_date',100),refetchInterval:1000,// Check every 1 second for near-instant messaging\nstaleTime:500,initialData:[]});const sendMutation=useMutation({mutationFn:messageData=>base44.entities.GlobalChatMessage.create(messageData),onSuccess:()=>{queryClient.invalidateQueries({queryKey:['globalChatMessages']});setMessage(\"\");}});const handleSend=e=>{e.preventDefault();if(!message.trim()||!user)return;sendMutation.mutate({sender_email:user.email,sender_name:user.full_name,sender_avatar_url:user.avatar_url,message:message.trim()});};useEffect(()=>{var _messagesEndRef$curre;(_messagesEndRef$curre=messagesEndRef.current)===null||_messagesEndRef$curre===void 0?void 0:_messagesEndRef$curre.scrollIntoView({behavior:\"smooth\"});},[messages]);return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-4xl mx-auto space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-5xl font-black text-white neon-text uppercase tracking-tight\",style:{color:\"#FFE500\"},children:\"GLOBAL CHAT\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xl font-bold text-white mt-2\",children:\"CONNECT WITH EVERYONE\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"brutalist-card p-6 h-[600px] flex flex-col\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 overflow-y-auto space-y-6 mb-4 pr-2\",children:[isLoading?/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-12\",children:/*#__PURE__*/_jsx(\"div\",{className:\"inline-block w-8 h-8 border-3 border-black border-t-[#FFE500] rounded-full animate-spin\"})}):messages.map(msg=>{var _msg$sender_name;const isMe=msg.sender_email===(user===null||user===void 0?void 0:user.email);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start gap-4\",children:[/*#__PURE__*/_jsx(Link,{to:createPageUrl(\"ViewProfile?email=\".concat(encodeURIComponent(msg.sender_email))),children:/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-gradient-to-br from-[#00D9FF] to-[#B026FF] rounded-full border-3 border-black flex items-center justify-center overflow-hidden flex-shrink-0\",children:msg.sender_avatar_url?/*#__PURE__*/_jsx(\"img\",{src:msg.sender_avatar_url,alt:\"Avatar\",className:\"w-full h-full object-cover\"}):/*#__PURE__*/_jsx(\"span\",{className:\"text-xl font-black text-white\",children:((_msg$sender_name=msg.sender_name)===null||_msg$sender_name===void 0?void 0:_msg$sender_name[0].toUpperCase())||\"X\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-black text-black uppercase\",children:isMe?\"YOU\":msg.sender_name}),/*#__PURE__*/_jsx(\"span\",{className:\"text-xs font-bold text-gray-500\",children:format(new Date(msg.created_date),\"h:mm a\")})]}),/*#__PURE__*/_jsx(\"p\",{className:\"p-3 bg-white border-3 border-black font-bold text-black break-words mt-1\",style:{boxShadow:'3px 3px 0 0 #000'},children:msg.message})]})]},msg.id);}),/*#__PURE__*/_jsx(\"div\",{ref:messagesEndRef})]}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSend,className:\"flex gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:message,onChange:e=>setMessage(e.target.value),placeholder:\"SAY SOMETHING TO THE WORLD...\",className:\"brutalist-input flex-1 px-4 py-3 font-bold\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:!message.trim()||sendMutation.isPending,className:\"brutalist-button bg-gradient-to-r from-[#FF0080] to-[#B026FF] text-white px-6 py-3\",children:/*#__PURE__*/_jsx(Send,{className:\"w-5 h-5\"})})]})]})]});}","map":{"version":3,"names":["React","useState","useEffect","useRef","base44","useQuery","useMutation","useQueryClient","Send","Circle","Link","createPageUrl","format","jsx","_jsx","jsxs","_jsxs","GlobalChat","message","setMessage","messagesEndRef","queryClient","data","user","queryKey","queryFn","auth","me","messages","isLoading","entities","GlobalChatMessage","list","refetchInterval","staleTime","initialData","sendMutation","mutationFn","messageData","create","onSuccess","invalidateQueries","handleSend","e","preventDefault","trim","mutate","sender_email","email","sender_name","full_name","sender_avatar_url","avatar_url","_messagesEndRef$curre","current","scrollIntoView","behavior","className","children","style","color","map","msg","_msg$sender_name","isMe","to","concat","encodeURIComponent","src","alt","toUpperCase","Date","created_date","boxShadow","id","ref","onSubmit","type","value","onChange","target","placeholder","disabled","isPending"],"sources":["/workspace/BigGrade-Main-files/src/pages/GlobalChat.jsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { base44 } from \"@/api/base44Client\";\nimport { useQuery, useMutation, useQueryClient } from \"@tanstack/react-query\";\nimport { Send, Circle } from \"lucide-react\";\nimport { Link } from \"react-router-dom\";\nimport { createPageUrl } from \"../utils\";\nimport { format } from \"date-fns\";\n\nexport default function GlobalChat() {\n  const [message, setMessage] = useState(\"\");\n  const messagesEndRef = useRef(null);\n  const queryClient = useQueryClient();\n\n  const { data: user } = useQuery({\n    queryKey: ['currentUser'],\n    queryFn: () => base44.auth.me(),\n  });\n\n  const { data: messages, isLoading } = useQuery({\n    queryKey: ['globalChatMessages'],\n    queryFn: () => base44.entities.GlobalChatMessage.list('created_date', 100),\n    refetchInterval: 1000, // Check every 1 second for near-instant messaging\n    staleTime: 500,\n    initialData: [],\n  });\n\n  const sendMutation = useMutation({\n    mutationFn: (messageData) => base44.entities.GlobalChatMessage.create(messageData),\n    onSuccess: () => {\n      queryClient.invalidateQueries({ queryKey: ['globalChatMessages'] });\n      setMessage(\"\");\n    },\n  });\n\n  const handleSend = (e) => {\n    e.preventDefault();\n    if (!message.trim() || !user) return;\n\n    sendMutation.mutate({\n      sender_email: user.email,\n      sender_name: user.full_name,\n      sender_avatar_url: user.avatar_url,\n      message: message.trim(),\n    });\n  };\n\n  useEffect(() => {\n    messagesEndRef.current?.scrollIntoView({ behavior: \"smooth\" });\n  }, [messages]);\n\n  return (\n    <div className=\"max-w-4xl mx-auto space-y-6\">\n      {/* Header */}\n      <div className=\"text-center\">\n        <h1 className=\"text-5xl font-black text-white neon-text uppercase tracking-tight\" style={{ color: \"#FFE500\" }}>\n          GLOBAL CHAT\n        </h1>\n        <p className=\"text-xl font-bold text-white mt-2\">\n          CONNECT WITH EVERYONE\n        </p>\n      </div>\n\n      {/* Messages */}\n      <div className=\"brutalist-card p-6 h-[600px] flex flex-col\">\n        <div className=\"flex-1 overflow-y-auto space-y-6 mb-4 pr-2\">\n          {isLoading ? (\n            <div className=\"text-center py-12\">\n              <div className=\"inline-block w-8 h-8 border-3 border-black border-t-[#FFE500] rounded-full animate-spin\"></div>\n            </div>\n          ) : (\n            messages.map((msg) => {\n              const isMe = msg.sender_email === user?.email;\n              return (\n                <div key={msg.id} className=\"flex items-start gap-4\">\n                  <Link to={createPageUrl(`ViewProfile?email=${encodeURIComponent(msg.sender_email)}`)}>\n                    <div className=\"w-12 h-12 bg-gradient-to-br from-[#00D9FF] to-[#B026FF] rounded-full border-3 border-black flex items-center justify-center overflow-hidden flex-shrink-0\">\n                      {msg.sender_avatar_url ? (\n                        <img src={msg.sender_avatar_url} alt=\"Avatar\" className=\"w-full h-full object-cover\" />\n                      ) : (\n                        <span className=\"text-xl font-black text-white\">\n                          {msg.sender_name?.[0].toUpperCase() || \"X\"}\n                        </span>\n                      )}\n                    </div>\n                  </Link>\n                  <div className=\"flex-1\">\n                    <div className=\"flex items-center gap-2\">\n                      <h4 className=\"font-black text-black uppercase\">\n                        {isMe ? \"YOU\" : msg.sender_name}\n                      </h4>\n                      <span className=\"text-xs font-bold text-gray-500\">\n                        {format(new Date(msg.created_date), \"h:mm a\")}\n                      </span>\n                    </div>\n                    <p className=\"p-3 bg-white border-3 border-black font-bold text-black break-words mt-1\" style={{boxShadow: '3px 3px 0 0 #000'}}>\n                      {msg.message}\n                    </p>\n                  </div>\n                </div>\n              );\n            })\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input */}\n        <form onSubmit={handleSend} className=\"flex gap-3\">\n          <input\n            type=\"text\"\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            placeholder=\"SAY SOMETHING TO THE WORLD...\"\n            className=\"brutalist-input flex-1 px-4 py-3 font-bold\"\n          />\n          <button\n            type=\"submit\"\n            disabled={!message.trim() || sendMutation.isPending}\n            className=\"brutalist-button bg-gradient-to-r from-[#FF0080] to-[#B026FF] text-white px-6 py-3\"\n          >\n            <Send className=\"w-5 h-5\" />\n          </button>\n        </form>\n      </div>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}